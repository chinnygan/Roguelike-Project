import java.io.LineNumberReader;
import java.util.ArrayList;
import java.util.List;

//Update 1: Added a few classes for getting damage values and for using items
//Update 2: Added function for evaluation a string representation of dice rolls, e.g. 1d8, 2d4, 3d6
	    Added heal function. More effects to follow.
import java.io.LineNumberReader;
import java.util.ArrayList;
import java.util.List;

public class Item {
	public static String chop(String s) {
		if (s.indexOf(',') != -1) {
			return s.substring(s.indexOf(',')+1, s.length());
		} else {
			return s.substring(0, s.indexOf(','));
		}
	}
	public static Item randomItem() {
		final int total = 13; // must be set to the number of items in the items.text file + 1
		return new Item((int)Math.floor(Math.random() * total));
	}
	private int id, def;
	private String name, type, dmg, description, effect;
		
	// Reads in a set of strings from the items.txt file in the format: name(dmg,def,type,rep,effect,description)
	// Assigns values and sets item variables to appropriate values
		
		private char rep;
		
		public Item(int id) {
			this.id = id;
			int i = 0;
			List<String> raw = new ArrayList<String>();
			In in= new In("C:/Users/Ross/Rogue/RogueProject/data/items.txt"); 
			while (in.hasNextLine()) {
				raw.add(i, in.readLine());
				i++;
			}
			decrypt(raw.get(id));
			switch (type) {
			case "Weapon":
				rep = ')';
				break;
			case "Armor":
				rep = ']';
				break;
			case "Consumable":
				rep = '!';
				break;
			}
		}
		
		public void decrypt(String s) {
			name = s.substring(0,s.indexOf('('));
			s = s.substring(s.indexOf('(')+1, s.indexOf(')'));
			dmg = s.substring(0, s.indexOf(','));
			s = Item.chop(s);
			def = Integer.parseInt(s.substring(0, s.indexOf(',')));
			s = Item.chop(s);
			type = (s.substring(0, s.indexOf(',')));
			s = Item.chop(s);
			effect = s.substring(0, s.length());
			s = Item.chop(s);
			description = (s.substring(0, s.length()));
		}
		
		public int evaluate(String dicerep) {
			int i, total = 0;
			for (i = 0; i < Integer.parseInt(dicerep.substring(0, dicerep.indexOf('d'))); i++) {
				total = total + (int) Math.ceil(Math.random() * Integer.parseInt(dicerep.substring(dicerep.indexOf('d')+1, dicerep.length())));
			}
			return total;
		}
		
		public int getdef() {
			return def;
		}
		
		public String getdescription() {
			return description;
		}
		
		public String getdmgString() {
			return dmg;
		}
		
		public int getdmgVal() {
			int total = 0;
			if (type == "Weapon") {
				if (dmg.contains("d")) {
					total = evaluate(dmg);
				} else {
					return 0;
				}
			}
			return total;
		}
		
		public int getid() {
			return id;
		}
		
		public String getname() {
			return name;
		}
		
		public char getrep() {
			return rep;
		}
		
		public String gettype() {
			return type;
		}
		
		public void heal(int n) {
			Combat.heal(evaluate("" + n + "d6"));
		}
		
		public void increasePlayerDef(Player p) {
			//p.setDmg(p.getDef()+1);
		}
		
		public void increasePlayerDmg(Player p) {
			//p.setDmg(p.getDmg()+1);
		}
		
		public void increasePlayerMaxHP(Player p) {
			//p.setHP(p.getHP()+5);
		}
			
		public void increasePlayerXP(Player p) {
			//p.setDmg(p.getDmg()+500);
		}
		
		@Override
		public String toString() {
			String out = "";
			switch (type) {
			case "Weapon":
				out = name + ": " + dmg + '\r' + description;
				break;
			case "Armor":
				out = name + ": DR " + def + '\r' + description;
				break;
			case "Consumable":
				out = name + ": " + '\r' + description;
				break;
			case "Misc":
				out = name + ": " + '\r' + description;
			}
			return out;
		}
		
		public void use() {
			// will go in Player class so the item can be deleted from inventory
		}
}
		


